<!doctype html><html lang="en_US"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Progressive web apps - codeaddslife</title><link rel="stylesheet" href="/main.css"><link rel="icon" type="image/png" href="/favicon.png"></head><body><div id="hd"><div class="wr"><a href="/"><img src="/logo.png" alt="codeaddslife"></a></div></div><div class="wr"><h1 id="progressive_web_apps">Progressive web apps</h1><p>The term <a href="https://developers.google.com/web/progressive-web-apps/">Progressive web apps</a> was coined in <a href="https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/">june 2015</a> by Alex Russell and Frances Berriman to bridge the gap between web apps and native apps. In this article, we will create a fully functioning progressive web app to show the main concepts in more detail.</p><h2 id="what_are_progressive_web_apps?">What are progressive web apps?</h2><p>Progressive web apps (PWA) are web applications that <em>progress over time</em>. If you happen to visit a website a lot, it can be great to cache some of these assets offline or to install it on the homescreen.</p><p>It is build on the foundation of <a href="https://alistapart.com/article/understandingprogressiveenhancement">progressive enhancement</a> and <a href="https://www.smashingmagazine.com/2011/01/guidelines-for-responsive-web-design">responsive web design</a>. Like any modern website, it should work for anybody anywhere and use more modern browser features when they are available.</p><p>Progressive web apps differ from hybrid apps as they are not installed via an app store (A process where you typically <a href="http://blog.gaborcselle.com/2012/10/every-step-costs-you-20-of-users.html">loose a lot of potential users</a>).</p><p>They are updated on the server, which costs less to maintain since all users are on the same version. PWA's rely heaviliy on service workers to provide a native app-like experience.</p><h2 id="example">Example</h2><p>In this article, we will build a progressive web app for my hometown's <a href="https://www.velo-antwerpen.be/en">bike renting service Velo</a>. A lot of cities have such a renting service nowadays as part of their public transport system. In our app, we want to show the availability of bikes per station (And also show the closest station, if you wanted to hop onto a bike right away).</p><p>TODO: velo-photo</p><p>I used <a href="vuejs.org">Vue.js</a> for this. This application is kept as simple as possible to focus on the PWA-specific parts. For a real world Vue.js application, you might want to check out Vue's <a href="https://github.com/vuejs/vue-cli">CLI tool</a>.</p><h2 id="getting_started">Getting Started</h2><p>First off, we start with a basic web application. The index.html-file will look like this:</p><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;MyBike&lt;/title&gt;
        &lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; href=&quot;img/favicon.png&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;main.css&quot; media=&quot;all&quot; /&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        &lt;meta name=&quot;theme-color&quot; content=&quot;#ffffff&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;app&quot;&gt;
            &lt;div id=&quot;logo&quot;&gt;
                &lt;img src=&quot;img/logo.png&quot; alt=&quot;MyBike&quot; /&gt;
            &lt;/div&gt;
            &lt;ul class=&quot;stations&quot;&gt;
                &lt;li v-for=&quot;station in stations&quot;&gt;
                    &lt;div class=&quot;station&quot;&gt;
                        &lt;div class=&quot;status&quot;&gt;
                            &lt;img v-if=&quot;station.bikes == station.slots&quot; src=&quot;img/status-full.png&quot; alt=&quot;{{station.address}}&quot; /&gt;
                            &lt;img v-else-if=&quot;station.bikes &gt; 0&quot; src=&quot;img/status-available.png&quot; alt=&quot;{{station.address}}&quot; /&gt;
                            &lt;img v-else-if=&quot;station.bikes == 0&quot; src=&quot;img/status-empty.png&quot; alt=&quot;{{station.address}}&quot; /&gt;
                            &lt;img v-else-if=&quot;station.status != OPN&quot; src=&quot;img/status-closed.png&quot; alt=&quot;{{station.address}}&quot; /&gt;
                        &lt;/div&gt;
                        &lt;strong&gt;{{station.address}} {{station.addressNumber}}&lt;/strong&gt;
                        &lt;div&gt;Bikes: {{station.bikes}} - Slots {{station.slots}}&lt;/div&gt;
                    &lt;/div&gt;
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        &lt;script src=&quot;js/axios.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;js/vue.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p>As you can see we load vue.js here, which will load a view for us based on the data that is coming back from our http request. To keep it simple, this data is a local JSON file.</p><pre><code>var app = new Vue({
    el: '#app',
    data: {
        stations: []
    },
    beforeMount: function () {
        this.loadStations();
    },
    methods: {
        loadStations: function () {
            var self = this;
            axios.get('/stations.json')
                .then(function (response) {
                    self.stations = response.data;
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    }
});</code></pre><p>We will also have some CSS for a basic design and to make this app responsive.</p><pre><code>body { color: #242729; font: 15px/1.3 Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif; margin: 40px 0; }
small { color: #999; }
#app { margin: 0 auto; max-width: 700px; }
#logo { margin-bottom: 40px; text-align: center; }
#logo img { width: 100px; height: auto; }
ul.stations { list-style: none; margin: 0 20px; padding: 0; position: relative; }
ul.stations li { border-bottom: 1px solid #e4e6e8; }
ul.stations li div.station { margin-bottom: 10px; margin-top: 10px; margin-left: 58px; }
ul.stations li div.station:after { content: ''; display: block; clear: both; }
ul.stations li div.station div.status { border-radius: 50%; float: left; margin-left: -58px; width: 48px; }
ul.stations li div.station div.status img { width: 48px; }</code></pre><p>To see the example for yourself, type the following commands:</p><pre><code>npm install -g browser-sync
npm start</code></pre><p>The app will now render beautifully on the different browsers.</p><p>TODO: screenshots</p><h1 id="service_workers">Service workers</h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service workers</a> are a big part of PWAs. They allow you to develop <a href="http://offlinefirst.org/">offline first</a>. A service worker is a javascript process that runs separately and acts as a programmable proxy between your application and the network. To avoid <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle attacks</a>, service workers have to run over https.</p><p>In order to notify the browser that you have a service worker available, you have to register it on load. We do this in the our <code>app.js</code> file. We also check if serviceWorker is a know feature in our browser, so when it's not, the app will not crash.</p><pre><code>if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function() {
        console.log('ServiceWorker registration successful');
    }).catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
}</code></pre><p>If you look at the code, you see that we register a seperate javascript file here. This is necassary as the service worker will run seperate from your other javascript code. The service worker also has no access to your DOM. <code>sw.js</code> should be created at the root-level, so not inside the js-folder.</p><p>Let's create <code>sw.js</code>:</p><pre><code class="language-javascript">var CACHE_NAME = 'my-bike-v1 ';
var CACHED_URLS = [
    '/',
    '/img/favicon.png',
    '/img/icon-120.png',
    '/img/icon-144.png',
    '/img/icon-152.png',
    '/img/icon-192.png',
    '/img/icon-384.png',
    '/img/logo.png',
    '/img/status-available.png',
    '/img/status-closed.png',
    '/img/status-empty.png',
    '/img/status-full.png',
    '/js/axios.min.js',
    '/js/vue.min.js',
    '/js/app.js',
    '/main.css'
];

self.addEventListener('install', function(event) {
    event.waitUntil(
        caches.open(CACHE_NAME).then(function(cache) {
            return cache.addAll(CACHED_URLS);
        })
    );

});</code></pre><p>What happens here? A service worker has a specific <a href="https://developers.google.com/web/fundamentals/instant-and-offline/service-worker/lifecycle">lifecycle</a> When a service worker is found, the browser will try to install it. <code>CACHED_URLS</code> contains all url's that need to be cached. This idea follows the <a href="https://developers.google.com/web/fundamentals/architecture/app-shell">app shell architecture</a>, where you cache all static assets, to startup the application very quickly. In our case, these are all used files, without the station.json file, as this is the dynamic data here.</p><p>If you try to cache a file that cannot be retrieved, the service worker won't be installed</p><p><img src="/img/0002_error_sw.png" alt="Service Worker failed to install"></p><p>Once the ServiceWorker is installed, we can listen to the activate-event.</p><pre><code class="language-javascript">self.addEventListener('activate', function(event) {
    event.waitUntil(
        caches.keys().then(function(cacheNames) {
            cacheNames.map(function(cacheName) {
                if (CACHE_NAME !== cacheName &amp;&amp; cacheName.startsWith('my-bike')) {
                    return caches.delete(cacheName);
                }
            })
        })
    );
});</code></pre><p>There is a difference between a ServiceWorker being installed and the ServiceWorker becoming activated. In our code, we want to listen to activate-events, because when a new version of the ServiceWorker becomes active, we want to delete our old cache. This is also why <code>CACHE_NAME</code> has a version (v1) in it's name. A new version will become v2.</p><p>The last part are fetch 'events'. When the service worker is installed, every request will trigger a fetch event. Inside this event, we can now return our cached resource, if we have one available.</p><p>Keep in mind that cached resource are only returned the second time you visit the application, as the first time you were still installing it. Also keep in mind that when you develop, especially on localhost, that the cache will kick it. Don't forget to clear the cache, or just to open a private window so you don't get confused.</p><pre><code class="language-javascript">self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request).then(function(response) {
            if (response) {
                return response;
            }
            return fetch(event.request);
        })
    );
});</code></pre><p>There are a lot of <a href="https://github.com/tjoskar/service-worker-exercises">examples</a> available for service workers. Keep in mind that service workers are a relatively new feature, so <a href="https://jakearchibald.github.io/isserviceworkerready">not all browsers support all features yet</a></p><h2 id="web_app_manifest">Web App Manifest</h2><p>A web app manifest is a JSON file that follows the <a href="https://www.w3.org/TR/appmanifest">W3Câ€™s specification</a>. It gives some metadata and notifies the browser that this application can be installed on the home screen.</p><p>The file should be added as a link-tag in the html file:</p><pre><code>&lt;link rel=&quot;manifest&quot; href=&quot;manifest.json&quot;&gt;</code></pre><p>The file itself is a json-file with the options that you specify.</p><pre><code>{
  &quot;name&quot;: &quot;MyBike&quot;,
  &quot;short_name&quot;: &quot;MyBike&quot;,
  &quot;start_url&quot;: &quot;.&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;theme_color&quot;: &quot;#fff&quot;,
  &quot;background_color&quot;: &quot;#fff&quot;,
  &quot;orientation&quot;: &quot;portrait&quot;,
  &quot;description&quot;: &quot;An app for renting bikes&quot;,
  &quot;icons&quot;: [{
    &quot;src&quot;: &quot;img/icon-120.png&quot;,
    &quot;sizes&quot;: &quot;120x120&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;img/icon-144.png&quot;,
    &quot;sizes&quot;: &quot;144x144&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;img/icon-152.png&quot;,
    &quot;sizes&quot;: &quot;152x152&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }, {
    &quot;src&quot;: &quot;img/icon-192.png&quot;,
    &quot;sizes&quot;: &quot;192x192&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  },{
    &quot;src&quot;: &quot;img/icon-384.png&quot;,
    &quot;sizes&quot;: &quot;384x384&quot;,
    &quot;type&quot;: &quot;image/png&quot;
  }]
}</code></pre><p>The display option represents the preferred display mode, once it is opened from the home screen. In most cases, standalone will be the best option for a progressive web app.</p><p>TODO: display 'fullscreen', 'browser', 'standalone'. If you configured the web app manifest correctly, the browser might decide to show an <a href="https://developers.google.com/web/fundamentals/engage-and-retain/app-install-banners/">Install Banner</a>. When and if the install banner is opened is browser-specifc and can be changed over time.</p><h2 id="source_code">Source code</h2><p><a href="https://github.com/optis/mybike">https://github.com/optis/mybike</a></p><h2 id="resources">Resources</h2></div></body></html>